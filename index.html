import React, { useEffect, useMemo, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { ShoppingCart, TicketPercent, Bike, Clock, Search, LogIn, Trash2, Plus, Minus, Star, Filter, Monitor, X, Settings as Gear } from "lucide-react";

// ===================== DIDOTWISTER ‚Äî Single Venue Mobile Web App =====================
// –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
// - –ö–Ω–æ–ø–∫–∞ ¬´—à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞¬ª (–∞–¥–º–∏–Ω) + –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –º–µ–Ω—é (–¥–æ–±–∞–≤–∏—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å)
// - –î–æ—Å—Ç—É–ø –ø–æ –∫–æ–¥—É 110798r
// - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–Ω—é –≤ localStorage (dw_menu)
// - –¢–∞–±–ª–æ –∫—É—Ö–Ω–∏/–≤—ã–¥–∞—á–∏ (–∫–æ–¥ —Ç–æ—Ç –∂–µ) ‚Äî –∫–Ω–æ–ø–∫–∞ –ú–æ–Ω–∏—Ç–æ—Ä —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞
// -------------------------------------------------------------------------------------

// --- Mock Venue --------------------------------------------------------------
const VENUE = {
  id: "didotwister-central",
  name: "DIDOTWISTER ‚Ä¢ Central Kitchen",
  address: "Vilnius, Gedimino pr. 10",
  eta: 25,
};

const CATEGORIES = [
  { id: "burgers", name: "–ë—É—Ä–≥–µ—Ä—ã", emoji: "üçî" },
  { id: "chicken", name: "–ö—É—Ä–∏—Ü–∞", emoji: "üçó" },
  { id: "buckets", name: "–ë–∞–∫–µ—Ç—ã", emoji: "üçü" },
  { id: "sides", name: "–°–∞–π–¥—Å—ã", emoji: "ü•î" },
  { id: "drinks", name: "–ù–∞–ø–∏—Ç–∫–∏", emoji: "ü•§" },
  { id: "desserts", name: "–î–µ—Å–µ—Ä—Ç—ã", emoji: "üç∞" },
];

const INITIAL_MENU = [
  { id: "ch-burger", name: "–ß–∏–∫–µ–Ω–±—É—Ä–≥–µ—Ä", desc: "–ö–æ—Ç–ª–µ—Ç–∞ –∏–∑ –∫—É—Ä–∏—Ü—ã, —Å–æ—É—Å, —Å–∞–ª–∞—Ç, –±—É–ª–æ—á–∫–∞", price: 3.9, category: "burgers", rating: 4.6, kcal: 410, img: "https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop", tags: ["—Ö–∏—Ç", "–æ—Å—Ç—Ä—ã–π"] },
  { id: "dbl-burger", name: "–î–∞–±–ª –ë—É—Ä–≥–µ—Ä", desc: "–î–≤–æ–π–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞ –∏ —Å—ã—Ä", price: 5.5, category: "burgers", rating: 4.7, kcal: 650, img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=1200&auto=format&fit=crop", tags: ["–Ω–æ–≤–∏–Ω–∫–∞"] },
  { id: "bucket-classic", name: "–ë–∞–∫–µ—Ç –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π", desc: "12 –∫—Ä—ã–ª—ã—à–µ–∫ + –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏", price: 12.9, category: "buckets", rating: 4.8, kcal: 1200, img: "https://images.unsplash.com/photo-1625944524821-31a37d4c0468?q=80&w=1200&auto=format&fit=crop", tags: ["—Å–µ–º—å–µ"] },
  { id: "strips-6", name: "–°—Ç—Ä–∏–ø—Å—ã (6 —à—Ç.)", desc: "–°–æ—á–Ω–∞—è –∫—É—Ä–∏—Ü–∞ –≤ –ø–∞–Ω–∏—Ä–æ–≤–∫–µ", price: 6.9, category: "chicken", rating: 4.5, kcal: 520, img: "https://images.unsplash.com/photo-1625944525460-4b74a53ce38e?q=80&w=1200&auto=format&fit=crop", tags: ["–æ—Å—Ç—Ä—ã–π"] },
  { id: "fries", name: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏", desc: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π", price: 2.2, category: "sides", rating: 4.4, kcal: 320, img: "https://images.unsplash.com/photo-1541592553160-82008b127ccb?q=80&w=1200&auto=format&fit=crop", tags: ["–≤–µ–≥"] },
  { id: "cola", name: "–ö–æ–ª–∞ 0.5", desc: "–ì–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫", price: 1.8, category: "drinks", rating: 4.2, kcal: 210, img: "https://images.unsplash.com/photo-1629203851121-93d139c0b6a4?q=80&w=1200&auto=format&fit=crop", tags: [] },
  { id: "ice-cream", name: "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ", desc: "–ü–ª–æ–º–±–∏—Ä –≤ —Å—Ç–∞–∫–∞–Ω—á–∏–∫–µ", price: 1.5, category: "desserts", rating: 4.1, kcal: 180, img: "https://images.unsplash.com/photo-1490324412536-e044eae4b85e?q=80&w=1200&auto=format&fit=crop", tags: ["–¥–µ—Ç—è–º"] },
];

const DELIVERY_SLOTS = ["–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ", "–ß–µ—Ä–µ–∑ 30 –º–∏–Ω", "–ß–µ—Ä–µ–∑ 1 —á–∞—Å", "–ö –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏‚Ä¶"];

const format = (n) => n.toFixed(2).replace(".", ",");

const Qty = ({ value, onDec, onInc }) => (
  <div className="inline-flex items-center gap-2 rounded-2xl border px-3 py-2">
    <button className="p-1.5" onClick={onDec} aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">
      <Minus size={18} />
    </button>
    <span className="w-7 text-center text-base">{value}</span>
    <button className="p-1.5" onClick={onInc} aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">
      <Plus size={18} />
    </button>
  </div>
);

// --- Tablo (Kitchen/Counter) ------------------------------------------------------
function Tablo({ open, onClose }) {
  const [auth, setAuth] = useState(false);
  const [code, setCode] = useState("");
  const [tab, setTab] = useState("active"); // active | ready
  const [orders, setOrders] = useState([
    { id: "DW-1024", status: "active", eta: 12, items: ["–ß–∏–∫–µ–Ω–±—É—Ä–≥–µ—Ä x2", "–§—Ä–∏ x1"], createdAt: Date.now() - 1000*60*8 },
    { id: "DW-1025", status: "active", eta: 18, items: ["–ë–∞–∫–µ—Ç –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π"], createdAt: Date.now() - 1000*60*5 },
    { id: "DW-1023", status: "ready", eta: 0, items: ["–°—Ç—Ä–∏–ø—Å—ã x6", "–ö–æ–ª–∞ 0.5"], createdAt: Date.now() - 1000*60*20 },
  ]);

  const markReady = (id) => setOrders((os)=> os.map(o => o.id===id?{...o,status:"ready",eta:0}:o));
  const complete = (id) => setOrders((os)=> os.filter(o => o.id!==id));

  if (!open) return null;
  return (
    <AnimatePresence>
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[70] bg-black/60">
        <motion.div initial={{ y: 40, opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: 40, opacity: 0 }} className="absolute left-1/2 top-4 -translate-x-1/2 w-[min(96%,1100px)] rounded-3xl overflow-hidden shadow-2xl">
          <div className="bg-black text-white px-5 py-4 flex items-center gap-3">
            <Monitor size={20}/> <div className="font-semibold">–¢–∞–±–ª–æ DIDOTWISTER</div>
            <button className="ml-auto opacity-80 hover:opacity-100" onClick={onClose}><X/></button>
          </div>

          {!auth ? (
            <div className="bg-white p-6">
              <div className="text-lg font-semibold mb-2">–í—Ö–æ–¥ –ø–æ –∫–æ–¥—É</div>
              <p className="text-sm text-gray-600 mb-4">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–æ.</p>
              <input value={code} onChange={(e)=>setCode(e.target.value)} placeholder="–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞" className="w-full rounded-2xl border px-4 py-3 mb-3"/>
              <button onClick={()=> setAuth(code === "110798r")} className="w-full rounded-2xl bg-black text-white py-3">–í–æ–π—Ç–∏</button>
              {code && code !== "110798r" && <div className="text-sm text-red-600 mt-2">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥</div>}
            </div>
          ) : (
            <div className="bg-white p-0">
              <div className="px-4 pt-4 flex gap-2">
                <button onClick={()=>setTab("active")} className={`flex-1 rounded-2xl px-3 py-2 border ${tab==='active'?'bg-black text-white':''}`}>–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                <button onClick={()=>setTab("ready")} className={`flex-1 rounded-2xl px-3 py-2 border ${tab==='ready'?'bg-black text-white':''}`}>–ì–æ—Ç–æ–≤—ã –∫ –≤—ã–¥–∞—á–µ</button>
              </div>
              <div className="p-4 grid md:grid-cols-2 gap-3">
                {orders.filter(o=> o.status===tab).map((o)=>(
                  <div key={o.id} className="rounded-2xl border p-4">
                    <div className="flex items-center justify-between mb-2">
                      <div className="text-lg font-bold">–ó–∞–∫–∞–∑ {o.id}</div>
                      <div className="text-sm text-gray-500">{tab==='active'?`~${o.eta} –º–∏–Ω`:'–≥–æ—Ç–æ–≤'}</div>
                    </div>
                    <ul className="text-sm list-disc pl-6 mb-3">
                      {o.items.map((i,idx)=>(<li key={idx}>{i}</li>))}
                    </ul>
                    <div className="flex gap-2">
                      {tab==='active' ? (
                        <button onClick={()=>markReady(o.id)} className="flex-1 rounded-xl bg-black text-white py-2">–ì–æ—Ç–æ–≤–æ</button>
                      ) : (
                        <button onClick={()=>complete(o.id)} className="flex-1 rounded-xl border py-2">–í—ã–¥–∞–Ω</button>
                      )}
                    </div>
                  </div>
                ))}
                {orders.filter(o=> o.status===tab).length===0 && (
                  <div className="text-gray-500 text-sm p-4">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>
                )}
              </div>
            </div>
          )}
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
}

// --- Settings (Menu Builder) ------------------------------------------------------
function SettingsPanel({ open, onClose, menu, setMenu }) {
  const [auth, setAuth] = useState(false);
  const [code, setCode] = useState("");
  const blank = { id: "", name: "", desc: "", price: 0, category: CATEGORIES[0].id, rating: 4.5, kcal: 0, img: "", tags: [] };
  const [draft, setDraft] = useState(blank);
  const [editingId, setEditingId] = useState(null);
  const [tagInput, setTagInput] = useState("");

  const resetForm = () => { setDraft(blank); setEditingId(null); setTagInput(""); };
  const toId = (name) => name.toLowerCase().replace(/\s+/g, "-").replace(/[^a-z0-9\-]/g, "") + "-" + Math.floor(Math.random()*10000);

  const addTag = () => {
    const t = tagInput.trim();
    if (!t) return; setDraft(d => ({ ...d, tags: Array.from(new Set([...(d.tags||[]), t])) })); setTagInput("");
  };
  const removeTag = (t) => setDraft(d => ({ ...d, tags: (d.tags||[]).filter(x=>x!==t) }));

  const onSave = () => {
    const rec = { ...draft, price: Number(draft.price), rating: Number(draft.rating), kcal: Number(draft.kcal) };
    if (editingId) {
      setMenu((m)=> m.map(item => item.id===editingId ? { ...rec, id: editingId } : item));
    } else {
      const id = rec.id?.trim() || toId(rec.name || "item");
      setMenu((m)=> [{ ...rec, id }, ...m]);
    }
    resetForm();
  };
  const onEdit = (id) => {
    const item = menu.find(i=>i.id===id);
    if (!item) return; setEditingId(id); setDraft({ ...item }); setTagInput("");
  };
  const onDelete = (id) => setMenu((m)=> m.filter(i=> i.id!==id));

  if (!open) return null;
  return (
    <AnimatePresence>
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-[80] bg-black/60">
        <motion.div initial={{ y: 40, opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: 40, opacity: 0 }} className="absolute left-1/2 top-4 -translate-x-1/2 w-[min(96%,1100px)] rounded-3xl overflow-hidden shadow-2xl bg-white">
          <div className="bg-black text-white px-5 py-4 flex items-center gap-3">
            <Gear size={20}/> <div className="font-semibold">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –º–µ–Ω—é ‚Ä¢ DIDOTWISTER</div>
            <button className="ml-auto opacity-80 hover:opacity-100" onClick={onClose}><X/></button>
          </div>

          {!auth ? (
            <div className="p-6">
              <div className="text-lg font-semibold mb-2">–í—Ö–æ–¥ –ø–æ –∫–æ–¥—É</div>
              <p className="text-sm text-gray-600 mb-4">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, —á—Ç–æ–±—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é.</p>
              <input value={code} onChange={(e)=>setCode(e.target.value)} placeholder="–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞" className="w-full rounded-2xl border px-4 py-3 mb-3"/>
              <button onClick={()=> setAuth(code === "110798r")} className="w-full rounded-2xl bg-black text-white py-3">–í–æ–π—Ç–∏</button>
              {code && code !== "110798r" && <div className="text-sm text-red-600 mt-2">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥</div>}
            </div>
          ) : (
            <div className="p-4 grid md:grid-cols-2 gap-4">
              {/* Form */}
              <div className="rounded-2xl border p-4 space-y-3">
                <div className="font-semibold">{editingId?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é":"–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é"}</div>
                <input value={draft.name} onChange={(e)=>setDraft({...draft,name:e.target.value})} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" className="w-full rounded-xl border px-3 py-2"/>
                <textarea value={draft.desc} onChange={(e)=>setDraft({...draft,desc:e.target.value})} placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" className="w-full rounded-xl border px-3 py-2"/>
                <div className="grid grid-cols-2 gap-2">
                  <input type="number" step="0.01" value={draft.price} onChange={(e)=>setDraft({...draft,price:e.target.value})} placeholder="–¶–µ–Ω–∞, ‚Ç¨" className="rounded-xl border px-3 py-2"/>
                  <input type="number" step="1" value={draft.kcal} onChange={(e)=>setDraft({...draft,kcal:e.target.value})} placeholder="–ö–∫–∞–ª" className="rounded-xl border px-3 py-2"/>
                </div>
                <div className="grid grid-cols-2 gap-2">
                  <select value={draft.category} onChange={(e)=>setDraft({...draft,category:e.target.value})} className="rounded-xl border px-3 py-2">
                    {CATEGORIES.map(c=> <option key={c.id} value={c.id}>{c.name}</option>)}
                  </select>
                  <input type="number" step="0.1" value={draft.rating} onChange={(e)=>setDraft({...draft,rating:e.target.value})} placeholder="–†–µ–π—Ç–∏–Ω–≥" className="rounded-xl border px-3 py-2"/>
                </div>
                <input value={draft.img} onChange={(e)=>setDraft({...draft,img:e.target.value})} placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" className="w-full rounded-xl border px-3 py-2"/>
                <div>
                  <div className="text-sm text-gray-600 mb-1">–¢–µ–≥–∏</div>
                  <div className="flex gap-2 mb-2">
                    <input value={tagInput} onChange={(e)=>setTagInput(e.target.value)} placeholder="–Ω–æ–≤–∏–Ω–∫–∞ / –æ—Å—Ç—Ä—ã–π / —Ö–∏—Ç" className="flex-1 rounded-xl border px-3 py-2"/>
                    <button onClick={addTag} className="rounded-xl border px-3 py-2">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</button>
                  </div>
                  <div className="flex flex-wrap gap-2">
                    {(draft.tags||[]).map(t=> (
                      <span key={t} className="px-2 py-0.5 text-xs rounded-full bg-gray-100 border">
                        {t} <button className="ml-1" onClick={()=>removeTag(t)}>√ó</button>
                      </span>
                    ))}
                  </div>
                </div>
                <div className="flex gap-2 pt-2">
                  <button onClick={onSave} className="flex-1 rounded-2xl bg-black text-white py-2">{editingId?"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å":"–î–æ–±–∞–≤–∏—Ç—å"}</button>
                  <button onClick={resetForm} className="rounded-2xl border px-4">–°–±—Ä–æ—Å</button>
                </div>
              </div>

              {/* List */}
              <div className="rounded-2xl border p-4">
                <div className="font-semibold mb-3">–¢–µ–∫—É—â–µ–µ –º–µ–Ω—é ({menu.length})</div>
                <div className="space-y-2 max-h-[60vh] overflow-auto pr-1">
                  {menu.map(item => (
                    <div key={item.id} className="flex items-center gap-3 border rounded-xl p-2">
                      <img src={item.img} alt="" className="w-14 h-14 object-cover rounded-lg"/>
                      <div className="flex-1 min-w-0">
                        <div className="font-medium truncate">{item.name}</div>
                        <div className="text-xs text-gray-500 truncate">‚Ç¨ {format(item.price)} ‚Ä¢ {CATEGORIES.find(c=>c.id===item.category)?.name} ‚Ä¢ {item.kcal} –∫–∫–∞–ª</div>
                      </div>
                      <button onClick={()=>onEdit(item.id)} className="rounded-xl border px-3 py-1.5">–ü—Ä–∞–≤–∏—Ç—å</button>
                      <button onClick={()=>onDelete(item.id)} className="rounded-xl border px-3 py-1.5 text-red-600">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
}

// --- Main App --------------------------------------------------------------
export default function DIDOTWISTERApp() {
  const [tab, setTab] = useState("delivery"); // delivery | pickup
  const [q, setQ] = useState("");
  const [cat, setCat] = useState("all");
  const [cart, setCart] = useState({}); // { id: qty }
  const [coupon, setCoupon] = useState("");
  const [slot, setSlot] = useState(DELIVERY_SLOTS[0]);
  const [isCartOpen, setCartOpen] = useState(false);
  const [authOpen, setAuthOpen] = useState(false);
  const [tabloOpen, setTabloOpen] = useState(false);
  const [settingsOpen, setSettingsOpen] = useState(false);

  // Menu state with localStorage persistence
  const [menu, setMenu] = useState(() => {
    try { const saved = localStorage.getItem("dw_menu"); return saved ? JSON.parse(saved) : INITIAL_MENU; } catch { return INITIAL_MENU; }
  });
  useEffect(()=>{
    try { localStorage.setItem("dw_menu", JSON.stringify(menu)); } catch {}
  }, [menu]);

  const add = (id) => setCart((c) => ({ ...c, [id]: (c[id] || 0) + 1 }));
  const dec = (id) => setCart((c) => {
    const v = (c[id] || 0) - 1;
    const n = { ...c };
    if (v <= 0) delete n[id];
    else n[id] = v;
    return n;
  });
  const remove = (id) => setCart((c) => { const n = { ...c }; delete n[id]; return n; });

  const items = useMemo(() => menu.filter((m) => (
    (cat === "all" || m.category === cat) &&
    (q.trim() === "" || m.name.toLowerCase().includes(q.toLowerCase()))
  )), [q, cat, menu]);

  const cartList = Object.entries(cart).map(([id, qty]) => ({
    ...menu.find((m) => m.id === id),
    qty,
    sum: (menu.find((m) => m.id === id)?.price || 0) * qty,
  })).filter(x=>x && x.name);

  const subtotal = cartList.reduce((a, b) => a + b.sum, 0);
  const discount = coupon.toLowerCase() === "WELCOME10" ? subtotal * 0.1 : 0;
  const deliveryFee = tab === "delivery" && subtotal > 0 ? 2.0 : 0;
  const total = Math.max(subtotal - discount + deliveryFee, 0);

  return (
    <div className="min-h-screen bg-white">
      {/* Mobile Header */}
     <header className="sticky top-0 z-40 backdrop-blur border-b bg-white/80">
  <div className="mx-auto px-3 py-3 flex items-center gap-3 max-w-2xl">
    <div className="text-2xl font-black tracking-tight flex items-center gap-2">
      DIDOTWISTER
      {/* –ö–Ω–æ–ø–∫–∞ –¢–∞–±–ª–æ —Ä—è–¥–æ–º —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º */}
      <button
        onClick={()=>setTabloOpen(true)}
        className="rounded-full border p-2"
        title="–¢–∞–±–ª–æ"
      >
        <Monitor size={18}/>
      </button>
      {/* –ö–Ω–æ–ø–∫–∞ –®–µ—Å—Ç–µ—Ä—ë–Ω–∫–∞ —Ä—è–¥–æ–º —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º */}
      <button
        onClick={()=>setSettingsOpen(true)}
        className="rounded-full border p-2"
        title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
      >
        <Gear size={18}/>
      </button>
    </div>

    <div className="ml-auto flex items-center gap-2">
      <button
        className="sm:hidden inline-flex items-center gap-2 border rounded-2xl px-3 py-2"
        onClick={()=>setAuthOpen(true)}
      >
        <LogIn size={18} />
      </button>
      <button
        className="relative inline-flex items-center gap-2 rounded-2xl bg-black text-white px-3 py-2"
        onClick={()=>setCartOpen(true)}
      >
        <ShoppingCart size={18} />
        <span className="hidden sm:inline">–ö–æ—Ä–∑–∏–Ω–∞</span>
        {cartList.length > 0 && (
          <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full text-xs w-6 h-6 grid place-items-center">
            {cartList.reduce((a,b)=>a+b.qty,0)}
          </span>
        )}
      </button>
    </div>
  </div>
</header>

      {/* Venue Bar */}
      <section className="mx-auto px-3 py-3 max-w-2xl">
        <div className="rounded-2xl border p-3 flex items-center gap-3">
          <div className="text-sm">
            <div className="font-semibold">{VENUE.name}</div>
            <div className="text-gray-500">{VENUE.address} ‚Ä¢ ~{VENUE.eta} –º–∏–Ω</div>
          </div>
          <div className="ml-auto text-sm inline-flex items-center gap-2">
            <Bike size={18}/>
            <div className="grid grid-cols-2 gap-1 rounded-xl border p-1">
              <button onClick={()=>setTab("delivery")} className={`px-2 py-1 rounded-lg ${tab==='delivery'?'bg-black text-white':''}`}>–î–æ—Å—Ç–∞–≤–∫–∞</button>
              <button onClick={()=>setTab("pickup")} className={`px-2 py-1 rounded-lg ${tab==='pickup'?'bg-black text-white':''}`}>–°–∞–º–æ–≤—ã–≤–æ–∑</button>
            </div>
          </div>
        </div>
      </section>

      {/* Search & Slots */}
      <section className="mx-auto px-3 max-w-2xl">
        <div className="flex gap-2">
          <div className="flex-1 flex items-center gap-2 border rounded-2xl px-3 py-2">
            <Search size={16} />
            <input className="outline-none w-full" placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–µ–Ω—é" value={q} onChange={(e)=>setQ(e.target.value)} />
          </div>
          <div className="min-w-[44%] flex items-center gap-2 border rounded-2xl px-3 py-2">
            <Clock size={16}/> <select className="bg-transparent outline-none w-full" value={slot} onChange={(e)=>setSlot(e.target.value)}>
              {DELIVERY_SLOTS.map((s)=> <option key={s} value={s}>{s}</option>)}
            </select>
          </div>
        </div>
      </section>

      {/* Category Bar */}
      <section className="mx-auto px-3 pt-3 max-w-2xl">
        <div className="flex items-center gap-2 overflow-auto pb-2">
          <button onClick={()=>setCat("all")} className={`px-3 py-2 rounded-xl border flex items-center gap-2 ${cat==='all'?'bg-black text-white':''}`}>
            <Filter size={16}/> –í—Å–µ
          </button>
          {CATEGORIES.map((c)=>(
            <button key={c.id} onClick={()=>setCat(c.id)} className={`px-3 py-2 rounded-xl border flex items-center gap-2 ${cat===c.id?'bg-black text-white':''}`}>
              <span>{c.emoji}</span>{c.name}
            </button>
          ))}
        </div>
      </section>

      {/* Menu Grid */}
      <main className="mx-auto px-3 py-4 max-w-2xl">
        {items.length === 0 ? (
          <div className="text-center text-gray-500">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ‚Ä¶</div>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
            {items.map((m) => (
              <motion.div key={m.id} layout className="rounded-3xl border overflow-hidden flex flex-col">
                <div className="relative">
                  <img src={m.img} alt={m.name} className="w-full h-40 object-cover"/>
                  <div className="absolute top-2 left-2 flex gap-2">
                    {(m.tags||[]).map(t => <span key={t} className="px-2 py-0.5 text-xs rounded-full bg-gray-100 border">{t}</span>)}
                  </div>
                </div>
                <div className="p-4 flex-1 flex flex-col">
                  <div className="flex items-start justify-between gap-2 mb-1">
                    <div className="font-semibold">{m.name}</div>
                    <div className="inline-flex items-center gap-1 text-sm text-yellow-600"><Star size={16}/>{m.rating}</div>
                  </div>
                  <p className="text-sm text-gray-600 flex-1">{m.desc}</p>
                  <div className="mt-3 flex items-center justify-between">
                    <div className="text-lg font-bold">‚Ç¨ {format(m.price)}</div>
                    {cart[m.id] ? (
                      <Qty value={cart[m.id]} onDec={()=>dec(m.id)} onInc={()=>add(m.id)} />
                    ) : (
                      <button className="rounded-2xl bg-black text-white px-3 py-2" onClick={()=>add(m.id)}>–î–æ–±–∞–≤–∏—Ç—å</button>
                    )}
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        )}
      </main>

      {/* Footer Info */}
      <footer className="mx-auto px-3 pb-28 text-xs text-gray-500 max-w-2xl">
        DIDOTWISTER ‚Äî –¥–µ–º–æ –æ–¥–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –º–µ–Ω—é –∏ —Ç–∞–±–ª–æ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
      </footer>

      {/* Floating Checkout Bar (Mobile-first) */}
      <div className="fixed bottom-4 left-1/2 -translate-x-1/2 w-[min(96%,680px)]">
        <div className="rounded-3xl shadow-lg border bg-white px-4 py-3 flex items-center gap-3">
          <div className="text-sm">
            <div className="font-semibold">{tab === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑'}</div>
            <div className="text-gray-500 text-xs">{VENUE.address} ‚Ä¢ ~{VENUE.eta} –º–∏–Ω</div>
          </div>
          <div className="ml-auto flex items-center gap-3">
            <div className="text-sm text-gray-600">–ò—Ç–æ–≥–æ: <span className="font-semibold text-black">‚Ç¨ {format(total)}</span></div>
            <button onClick={()=>setCartOpen(true)} className="rounded-2xl bg-black text-white px-4 py-2 flex items-center gap-2">
              <ShoppingCart size={18}/> –û—Ñ–æ—Ä–º–∏—Ç—å
            </button>
          </div>
        </div>
      </div>

      {/* Round FABs */}
      

      {/* Promo Banner */}
      <section className="mx-auto px-3 pt-3 max-w-2xl">
        <div className="relative overflow-hidden rounded-3xl bg-gradient-to-br from-black to-gray-800 text-white p-5">
          <div className="text-2xl font-bold mb-1">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ DIDOTWISTER</div>
          <p className="opacity-90 mb-4">–ü—Ä–æ–º–æ–∫–æ–¥ <b>WELCOME10</b> –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ ‚Äî —Å–∫–∏–¥–∫–∞ 10%.</p>
          <div className="flex items-center gap-2 text-sm opacity-90"><TicketPercent size={16}/> –¢–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
      </section>

      {/* Cart Drawer */}
      <AnimatePresence>
        {isCartOpen && (
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-50 bg-black/40">
            <motion.aside initial={{ x: 400 }} animate={{ x: 0 }} exit={{ x: 400 }} transition={{ type: "spring", stiffness: 240, damping: 24 }} className="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl">
              <div className="p-4 border-b flex items-center justify-between">
                <div className="font-semibold">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <button className="text-gray-500" onClick={()=>setCartOpen(false)}>–ó–∞–∫—Ä—ã—Ç—å</button>
              </div>

              <div className="p-4 space-y-4 overflow-auto h-[calc(100%-240px)]">
                {cartList.length === 0 ? (
                  <div className="text-gray-500 text-sm">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
                ) : cartList.map((it) => (
                  <div key={it.id} className="flex items-center gap-3">
                    <img src={it.img} alt="" className="w-16 h-16 object-cover rounded-xl"/>
                    <div className="flex-1">
                      <div className="font-medium">{it.name}</div>
                      <div className="text-xs text-gray-500">‚Ç¨ {format(it.price)} ‚Ä¢ {it.kcal} –∫–∫–∞–ª</div>
                      <div className="mt-2"><Qty value={it.qty} onDec={()=>dec(it.id)} onInc={()=>add(it.id)}/></div>
                    </div>
                    <div className="text-right">
                      <div className="font-semibold">‚Ç¨ {format(it.sum)}</div>
                      <button className="text-gray-400 text-xs inline-flex items-center gap-1 mt-1" onClick={()=>remove(it.id)}>
                        <Trash2 size={14}/> —É–¥–∞–ª–∏—Ç—å
                      </button>
                    </div>
                  </div>
                ))}
              </div>

              <div className="p-4 border-t space-y-3">
                <div className="flex items-center gap-2">
                  <input className="flex-1 rounded-2xl border px-3 py-2" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" value={coupon} onChange={(e)=>setCoupon(e.target.value)} />
                </div>
                <div className="text-sm space-y-1">
                  <div className="flex justify-between"><span>–°—É–º–º–∞</span><span>‚Ç¨ {format(subtotal)}</span></div>
                  {discount>0 && <div className="flex justify-between text-green-600"><span>–°–∫–∏–¥–∫–∞</span><span>- ‚Ç¨ {format(discount)}</span></div>}
                  {deliveryFee>0 && <div className="flex justify-between"><span>–î–æ—Å—Ç–∞–≤–∫–∞</span><span>‚Ç¨ {format(deliveryFee)}</span></div>}
                  <div className="flex justify-between font-semibold pt-2 border-t"><span>–ò—Ç–æ–≥–æ</span><span>‚Ç¨ {format(total)}</span></div>
                </div>
                <button className="w-full rounded-2xl bg-black text-white py-3">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ (–¥–µ–º–æ)</button>
              </div>
            </motion.aside>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Auth Modal (Mock) */}
      <AnimatePresence>
        {authOpen && (
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="fixed inset-0 z-50 bg-black/40">
            <motion.div initial={{ scale: 0.95, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} exit={{ scale: 0.95, opacity: 0 }} className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[min(92%,480px)] bg-white rounded-3xl shadow-2xl p-6">
              <div className="text-lg font-semibold mb-4">–í–æ–π—Ç–∏ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</div>
              <div className="space-y-3">
                <input className="w-full rounded-2xl border px-4 py-3" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ email" />
                <button className="w-full rounded-2xl bg-black text-white py-3">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ (–¥–µ–º–æ)</button>
              </div>
              <button className="mt-4 w-full text-sm text-gray-500" onClick={()=>setAuthOpen(false)}>–ó–∞–∫—Ä—ã—Ç—å</button>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Panels */}
      <Tablo open={tabloOpen} onClose={()=>setTabloOpen(false)} />
      <SettingsPanel open={settingsOpen} onClose={()=>setSettingsOpen(false)} menu={menu} setMenu={setMenu} />

      {/* Dev TODOs */}
      {/*
        –†–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
        - Catalog API + RBAC (—Ä–æ–ª—å: –∞–¥–º–∏–Ω) –≤–º–µ—Å—Ç–æ –ª–æ–∫. –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        - –ó–∞–∫–∞–∑—ã -> –¢–∞–±–ª–æ (–≤–µ–±-—Å–æ–∫–µ—Ç—ã)
        - –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç CSV/JSON –¥–ª—è –º–µ–Ω—é
      */}
    </div>
  );
}
