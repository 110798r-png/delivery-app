<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>–Ø–º–∞–ú–æ—Ç–æ ‚Äî –æ–Ω–ª–∞–π–Ω-–∑–∞–∫–∞–∑</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    html, body { width:100%; max-width:100%; overflow-x:hidden; background:#f9fafb; }
    *, *::before, *::after { box-sizing:border-box; }
    img { max-width:100%; display:block; }
    .hidden{ display:none }
    .phone-shell{ width:min(100vw,540px); margin:0 auto; padding:0 .35rem; }

    .toast{ position:fixed; right:1rem; bottom:1rem; background:#111; color:#fff; padding:.75rem 1rem; border-radius:12px;
      box-shadow:0 6px 20px rgba(0,0,0,.2); opacity:.95; z-index:9999 }

    .glass-panel{ background:radial-gradient(circle at 10% 20%, rgba(255,255,255,.85) 0%, rgba(255,255,255,.45) 45%, rgba(255,255,255,.25) 100%);
      backdrop-filter:blur(18px); border:1px solid rgba(255,255,255,.4); box-shadow:0 14px 40px rgba(15,23,42,.12) }
    .no-scrollbar::-webkit-scrollbar{ display:none } .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none }
    .sticky-top{ position:sticky; top:.5rem; z-index:30 }

    .menu-card{ display:flex; gap:.75rem; align-items:center; background:#fff; border:1px solid #edf2f7; border-radius:1.25rem; padding:1rem; min-height:6.4rem }
    .menu-card-img{ width:110px; height:70px; border-radius:.75rem; background:#eee; object-fit:cover }

    /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
    .confirm-bar{
      position:fixed; left:50%; transform:translateX(-50%); bottom:0;
      width:min(540px, 100vw); background:#fff; border-top:1px solid #e5e7eb;
      padding:.6rem .9rem; z-index:50; box-shadow:0 -10px 25px rgba(15,23,42,.06);
    }

    /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–µ–π–¥–∂–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
    #catPager{
      display:flex;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
      touch-action: pan-x pinch-zoom;   /* –∂–µ—Å—Ç –ø–æ X —Ä–∞–∑—Ä–µ—à–∞–µ–º –Ω–∞ —Å–∞–º–æ–º –ø–µ–π–¥–∂–µ—Ä–µ */
    }
    .cat-panel{
      flex:0 0 100%;
      scroll-snap-align:start;
      scroll-snap-stop: always;         /* –∏—Å–∫–ª—é—á–∞–µ–º ¬´–ø–µ—Ä–µ–ø—Ä—ã–≥¬ª —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–≤–∞–π–ø–∞ */
      padding:0;
    }

    /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –ø–∞–Ω–µ–ª–∏ ‚Äî –∑–¥–µ—Å—å –º—ã –ª–æ–≤–∏–º Pointer –∏ —Ä–µ—à–∞–µ–º, –∫–æ–≥–¥–∞ ¬´—É–≤–µ–∑—Ç–∏¬ª –ø–µ–π–¥–∂–µ—Ä */
    .v-scroll{
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;
      touch-action: pan-y;              /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å ‚Äî –Ω–∞—Ç–∏–≤–Ω–∞—è; –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å –æ—Ç–¥–∞—ë–º JS */
    }
  </style>
</head>
<body>
  <div class="w-full py-3">
    <!-- Header -->
    <header id="appHeader" class="phone-shell flex items-center justify-between mb-3 sm:mb-4">
      <div class="leading-tight">
        <div class="text-2xl font-extrabold tracking-tight">–Ø–º–∞–ú–æ—Ç–æ</div>
        <div class="text-[12px] text-gray-600 -mt-0.5">—Å—É—à–∏ ‚Ä¢ —Ä–æ–ª–ª—ã ‚Ä¢ —Ñ–∞—Å—Ç—Ñ—É–¥</div>
      </div>
      <button id="profileBtn" class="px-3 py-2 rounded-xl border bg-white" aria-label="profile">üë§</button>
    </header>

    <!-- Screens -->
    <main id="app" class="phone-shell"></main>
  </div>

  <div id="toast" class="toast hidden"></div>

<script>
/* ===== Config & helpers ===== */
const PROFILE_LS_KEY = 'client_profile_v1';
if (!location.hash || location.hash === "#/" || location.hash === "#") location.hash = "#/order";

function getClientId(){ const KEY='yc_client_id_v1'; let cid=localStorage.getItem(KEY); if(!cid){ cid='cid-'+Math.random().toString(36).slice(2)+Date.now(); localStorage.setItem(KEY,cid); } return cid; }
function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 2500); }
function el(html){ const t=document.createElement('template'); t.innerHTML=html.trim(); return t.content.firstChild; }
function money(x){ return x+' —Ä—É–±.' }
function loadProfile(){ try{ return JSON.parse(localStorage.getItem(PROFILE_LS_KEY))||{} }catch{ return {} } }
function setBodyScrollLock(on){ document.body.style.overflow = on ? 'hidden' : ''; }

/* Menu data (–¥–æ–±–∞–≤–∏–ª ¬´–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã¬ª) */
const MENU_CATEGORIES = [
  { key:'burgers', title:'–ë—É—Ä–≥–µ—Ä—ã', items:[
    { name:'–ì–æ–≤—è–∂–∏–π –±—É—Ä–≥–µ—Ä', price:280, img:'https://images.unsplash.com/photo-1603064752734-4c48eff53d05?w=400&auto=format&fit=crop' },
    { name:'–ì–æ–≤—è–∂–∏–π –¥–≤–æ–π–Ω–æ–π', price:340, img:'https://images.unsplash.com/photo-1516684541-b4de0a07a2e1?w=400&auto=format&fit=crop' },
    { name:'–ö—É—Ä–∏–Ω—ã–π –±—É—Ä–≥–µ—Ä',  price:200, img:'https://images.unsplash.com/photo-1604908176997-1251882fde0b?w=400&auto=format&fit=crop' },
    { name:'–ö—É—Ä–∏–Ω—ã–π –¥–≤–æ–π–Ω–æ–π', price:250, img:'https://images.unsplash.com/photo-1603366615917-1fa6dad5c4fa?w=400&auto=format&fit=crop' },
    { name:'–ß–∏–∑–±—É—Ä–≥–µ—Ä', price:220 }
  ]},
  { key:'twisters', title:'–¢–≤–∏—Å—Ç–µ—Ä—ã', items:[
    { name:'–¢–≤–∏—Å—Ç–µ—Ä –æ–±—ã—á–Ω—ã–π', price:200 }, { name:'–¢–≤–∏—Å—Ç–µ—Ä –º–∞–∫—Å', price:250 }
  ]},
  { key:'drinks',  title:'–ù–∞–ø–∏—Ç–∫–∏', items:[
    { name:'–î–æ–±—Ä—ã–π –∫–æ–ª–∞', price:100 }, { name:'–î–æ–±—Ä—ã–π –∞–ø–µ–ª—å—Å–∏–Ω', price:100 },
    { name:'–°–ø—Ä–∞–π—Ç', price:100 }, { name:'–≠—Å–ø—Ä–µ—Å—Å–æ', price:120 }
  ]},
  { key:'sushi',   title:'–°—É—à–∏ / —Ä–æ–ª–ª—ã', items:[
    { name:'–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è', price:350 }, { name:'–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è', price:390 }, { name:'–ê–ª—è—Å–∫–∞', price:350 }
  ]},
  { key:'semi',   title:'–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã', items:[
    { name:'–ù–∞–≥–≥–µ—Ç—Å—ã 6 —à—Ç.', price:160 }, { name:'–ù–∞–≥–≥–µ—Ç—Å—ã 9 —à—Ç.', price:210 }, { name:'–°—Ç—Ä–∏–ø—Å—ã', price:190 }
  ]},
];

/* ===== –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –ø–æ X –±–µ–∑ –∏–Ω–µ—Ä—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ ===== */
function easeInOutCubic(t){ return t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2 }
function animateScrollX(el, to, {duration=280, onStart, onEnd}={}){
  const from = el.scrollLeft;
  const diff = to - from;
  if (diff===0){ onStart&&onStart(); onEnd&&onEnd(); return; }
  const startTs = performance.now();
  let rafId = null;
  onStart && onStart();
  const step = (ts)=>{
    const t = Math.min(1, (ts - startTs)/duration);
    const v = from + diff * easeInOutCubic(t);
    el.scrollLeft = v;
    if (t < 1){ rafId = requestAnimationFrame(step); }
    else { onEnd && onEnd(); }
  };
  rafId = requestAnimationFrame(step);
  return ()=> cancelAnimationFrame(rafId);
}

/* ===== Order View ===== */
function OrderView(){
  const root=el(`
    <div class="relative">
      <section class="sticky-top mb-2">
        <div class="glass-panel rounded-2xl px-3 py-3">
          <div id="categoryBar" class="flex gap-2 overflow-x-auto no-scrollbar"></div>
        </div>
      </section>

      <section>
        <div id="catPager" class="no-scrollbar"></div>
      </section>

      <div id="confirmBar" class="confirm-bar">
        <div class="flex items-center justify-between gap-3">
          <div class="text-base"><span class="text-gray-600">–ò—Ç–æ–≥–æ:</span> <b id="totalVal">0 —Ä—É–±.</b></div>
          <button id="confirmBtn" class="px-4 py-3 rounded-xl bg-black text-white disabled:opacity-40 disabled:cursor-not-allowed">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
      </div>
    </div>
  `);

  const categoryBar=root.querySelector('#categoryBar');
  const catPager=root.querySelector('#catPager');
  const confirmBar=root.querySelector('#confirmBar');
  const totalEl=root.querySelector('#totalVal');
  const confirmBtn=root.querySelector('#confirmBtn');

  setBodyScrollLock(true);

  /* ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏ FSM ===== */
  const counts={}; const scrollMemory=new Map();
  let activeIdx=0;
  let isAnimating=false;
  let panelW = ()=> catPager.getBoundingClientRect().width || 1;

  /* –ß–∏–ø—ã */
  MENU_CATEGORIES.forEach((cat,idx)=>{
    categoryBar.appendChild(el(
      `<button type="button" class="px-3 py-1.5 rounded-full border text-sm whitespace-nowrap ${idx===0?'bg-black text-white border-black':'bg-white/50'}" data-idx="${idx}">${cat.title}</button>`
    ));
  });

  function highlightChip(idx){
    categoryBar.querySelectorAll('button').forEach((b,i)=>{
      const on=i===idx;
      b.classList.toggle('bg-black',on); b.classList.toggle('text-white',on); b.classList.toggle('border-black',on);
      if(on){ b.scrollIntoView({inline:'center', block:'nearest', behavior:'smooth'}); }
    });
  }

  function goToIndex(idx, {animate=true}={}){
    idx = Math.max(0, Math.min(MENU_CATEGORIES.length-1, idx));
    if (idx===activeIdx && !animate) return;
    const targetLeft = Math.round(panelW()*idx);

    // –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å —á–∏–ø (–≤–∏–∑—É–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
    highlightChip(idx);

    if (!animate){
      catPager.scrollSnapType = 'x mandatory';
      catPager.scrollLeft = targetLeft;
      activeIdx = idx;
      return;
    }

    // –±–ª–æ–∫–∏—Ä—É–µ–º —Å–Ω–∞–ø –∏ —Å–∫—Ä–æ–ª–ª-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
    isAnimating = true;
    const prevSnap = catPager.style.scrollSnapType;
    catPager.style.scrollSnapType = 'none';

    // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —Å—Ç–∞—Ä–æ–π –ø–∞–Ω–µ–ª–∏
    const oldPanel = catPager.children[activeIdx];
    if (oldPanel){
      const oldBox = oldPanel.querySelector('.v-scroll');
      scrollMemory.set(MENU_CATEGORIES[activeIdx].key, oldBox.scrollTop);
    }

    // –∞–Ω–∏–º–∏—Ä—É–µ–º
    animateScrollX(catPager, targetLeft, {
      duration: 280,
      onStart(){},
      onEnd(){
        // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å scrollTop –Ω–∞ –Ω–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
        const newPanel = catPager.children[idx];
        const newBox = newPanel?.querySelector('.v-scroll');
        if (newBox){
          const key = MENU_CATEGORIES[idx].key;
          newBox.scrollTop = scrollMemory.get(key) || 0;
        }
        activeIdx = idx;
        isAnimating = false;
        catPager.style.scrollSnapType = prevSnap || 'x mandatory';
      }
    });
  }

  // –∫–ª–∏–∫ –ø–æ —á–∏–ø–∞–º ‚Äî —Å—Ç—Ä–æ–≥–æ –∫ –∏–Ω–¥–µ–∫—Å—É —Å –Ω–∞—à–µ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
  categoryBar.addEventListener('click', (e)=>{
    const btn=e.target.closest('button[data-idx]'); if(!btn) return;
    const idx=Number(btn.dataset.idx);
    if (isAnimating) return;
    goToIndex(idx, {animate:true});
  });

  /* –†–µ–Ω–¥–µ—Ä –ø–∞–Ω–µ–ª–µ–π */
  function buildPanels(){
    catPager.innerHTML='';
    MENU_CATEGORIES.forEach((cat, idx)=>{
      const panel=el(`<div class="cat-panel"></div>`);
      const vbox =el(`<div class="v-scroll px-0.5"></div>`);
      const list =el(`<div class="grid gap-3"></div>`);

      // –∫–∞—Ä—Ç–æ—á–∫–∏
      cat.items.forEach(it=>{
        const q=counts[it.name]||0;
        list.appendChild(el(`
          <div class="menu-card">
            <div class="flex-1 min-w-0">
              <div class="font-medium text-sm">${it.name}</div>
              <div class="text-xs text-gray-500 mt-1">${money(it.price)}</div>
              <div class="flex items-center gap-3 mt-3">
                <button type="button" class="w-8 h-8 rounded-xl border" data-name="${it.name}" data-act="dec">‚àí</button>
                <div class="w-6 text-center text-sm" data-q="${it.name}">${q}</div>
                <button type="button" class="w-8 h-8 rounded-xl bg-black text-white" data-name="${it.name}" data-act="inc">+</button>
              </div>
            </div>
            <img src="${it.img||'https://placehold.co/110x70?text=food'}" class="menu-card-img" alt="">
          </div>`));
      });
      list.appendChild(el(`<div class="h-24"></div>`));

      vbox.appendChild(list);
      panel.appendChild(vbox);
      catPager.appendChild(panel);

      /* === Pointer-only ¬´–º–æ—Å—Ç¬ª —Å–≤–∞–π–ø–∞: —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∑–∞ –∂–µ—Å—Ç === */
      let down=false, used=false, sx=0, sy=0, lockedDir=null; // 'x' | 'y' | null
      const PIX_LOCK = 10;                     // –ø–æ—Å–ª–µ 10px ‚Äî ¬´–∑–∞–º–æ–∫¬ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
      const THRESH   = ()=> Math.max(40, panelW()*0.25); // –ø–æ—Ä–æ–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

      vbox.addEventListener('pointerdown',(e)=>{
        if (isAnimating) return;
        down=true; used=false; sx=e.clientX; sy=e.clientY; lockedDir=null;
        vbox.setPointerCapture(e.pointerId);
      });
      vbox.addEventListener('pointermove',(e)=>{
        if(!down || isAnimating || used) return;
        const dx=e.clientX-sx, dy=e.clientY-sy;
        if (lockedDir===null){
          if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > PIX_LOCK) lockedDir='x';
          else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > PIX_LOCK) lockedDir='y';
        }
        if (lockedDir==='x'){
          // –±–µ—Ä—ë–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –Ω–µ –¥–∞—ë–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–º—É —Å–∫—Ä–æ–ª–ª—É ¬´—Å—ä–µ—Å—Ç—å¬ª –∂–µ—Å—Ç
          e.preventDefault();
          if (Math.abs(dx) >= THRESH()){
            used=true;
            const next = dx<0 ? activeIdx+1 : activeIdx-1;
            goToIndex(next, {animate:true});
          }
        }
      }, {passive:false});
      const endPtr = (e)=>{ down=false; used=false; lockedDir=null; try{ vbox.releasePointerCapture?.(e.pointerId); }catch{} };
      vbox.addEventListener('pointerup', endPtr);
      vbox.addEventListener('pointercancel', endPtr);
      vbox.addEventListener('pointerleave', endPtr);
    });

    // –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ +/‚àí ‚Äî –æ–¥–∏–Ω —Ä–∞–∑
    if(!catPager._plusMinusBound){
      catPager.addEventListener('click', (e)=>{
        const act=e.target?.dataset?.act; if(!act) return;
        const name=e.target.dataset.name;
        if(act==='inc') counts[name]=(counts[name]||0)+1;
        if(act==='dec') counts[name]=Math.max(0,(counts[name]||0)-1);
        catPager.querySelectorAll(`[data-q="${CSS.escape(name)}"]`).forEach(el=> el.textContent=counts[name]||0);
        recalcTotal();
      });
      catPager._plusMinusBound=true;
    }

    applyHeights();
    setTimeout(applyHeights,60);
  }

  /* –í—ã—Å–æ—Ç–∞: ~4 –∫–∞—Ä—Ç–æ—á–∫–∏ (–∏–ª–∏ –º–µ–Ω—å—à–µ, –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω –∫–æ—Ä–æ—Ç–∫–∏–π) */
  function applyHeights(){
    const headerH = document.getElementById('appHeader').getBoundingClientRect().height;
    const chipsH  = root.querySelector('.sticky-top').getBoundingClientRect().height;
    const confirmH= confirmBar.getBoundingClientRect().height;
    const availH  = Math.max(240, window.innerHeight - headerH - chipsH - confirmH - 8);

    const firstCard = catPager.querySelector('.menu-card');
    const cardH = firstCard ? Math.ceil(firstCard.getBoundingClientRect().height) : 104;
    const gap = 12; // Tailwind gap-3
    const desired = cardH*4 + gap*3 + 4; // 4 –∫–∞—Ä—Ç–æ—á–∫–∏ + 3 –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞

    const h = Math.min(availH, desired);
    root.querySelectorAll('.v-scroll').forEach(el=> el.style.height = h+'px');

    // –¥–µ—Ä–∂–∏–º —Ç–µ–∫—É—â—É—é –ø–∞–Ω–µ–ª—å –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω–æ–π
    goToIndex(activeIdx, {animate:false});
  }
  window.addEventListener('resize', applyHeights);

  /* –í–æ –≤—Ä–µ–º—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ –ø–µ–π–¥–∂–µ—Ä–∞ ‚Äî –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å, –µ—Å–ª–∏ –∏–¥—ë—Ç –Ω–∞—à–∞ –∞–Ω–∏–º–∞—Ü–∏—è */
  catPager.addEventListener('scroll', ()=>{
    if (isAnimating) return;
    // –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–≤–∞–π–ø–Ω—É–ª –ø–æ —Å–∞–º–æ–º—É catPager (–Ω–µ –ø–æ —Å–ø–∏—Å–∫—É), —Å–Ω–∞–ø –¥–æ–≤–µ–∑—ë—Ç –¥–æ –±–ª–∏–∂–Ω–µ–≥–æ.
    // –û–≥—Ä–∞–Ω–∏—á–∏–º –ø–µ—Ä–µ—Å—á—ë—Ç –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ü–µ–ª–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–Ω–µ—Ä—Ü–∏–∏:
    if (catPager._scrollTimer) clearTimeout(catPager._scrollTimer);
    catPager._scrollTimer = setTimeout(()=>{
      const idx = Math.round(catPager.scrollLeft / panelW());
      if (idx !== activeIdx){
        // –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å —á–∏–ø –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å (–±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏, —Å–Ω–∞–ø —É–∂–µ –≤—ã—Ä–æ–≤–Ω—è–ª)
        highlightChip(idx);
        activeIdx = idx;
      }
    }, 80);
  });

  function recalcTotal(){
    let sum=0;
    MENU_CATEGORIES.forEach(cat=>cat.items.forEach(it=>{ sum += (counts[it.name]||0) * it.price; }));
    totalEl.textContent = money(sum);
    confirmBtn.disabled = sum<=0;
    return sum;
  }

  confirmBtn.addEventListener('click', ()=>{
    const items=[];
    MENU_CATEGORIES.forEach(cat=>cat.items.forEach(it=>{
      const q=counts[it.name]||0; if(q>0) items.push({name:it.name, qty:q, price:it.price});
    }));
    if(!items.length){ showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã'); return }
    const total = items.reduce((s,i)=>s+i.price*i.qty,0);
    const prof=loadProfile();
    if(!prof.name || !prof.phone || !prof.address){ showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å'); return }
    alert('–ó–∞–∫–∞–∑ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω: '+total+' —Ä—É–±. (–¥–µ–º–æ)');
  });

  buildPanels();
  highlightChip(0);
  // –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å—Ç–∞—Ä—Ç
  requestAnimationFrame(()=> goToIndex(0,{animate:false}));
  recalcTotal();

  root.cleanup = ()=> setBodyScrollLock(false);
  return root;
}

/* –ü—Ä–æ—Ñ–∏–ª—å (–∑–∞–≥–ª—É—à–∫–∞) */
function ProfileView(){
  const root=el(`<div class="grid gap-4 pb-24">
    <div class="glass-panel rounded-2xl p-5">
      <h2 class="font-semibold mb-2">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
      <button class="mt-3 px-4 py-2 rounded-xl border" id="backToMenu">–ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
    </div>
  </div>`);
  root.querySelector('#backToMenu').onclick=()=> location.hash='#/order';
  root.cleanup = ()=> setBodyScrollLock(false);
  return root;
}

/* ===== Router ===== */
function router(){
  const app=document.getElementById('app');
  if (app.firstChild && typeof app.firstChild.cleanup === 'function') { try{ app.firstChild.cleanup(); }catch{} }
  app.innerHTML='';
  const hash=location.hash;
  if(hash==='#/profile'){ app.classList.add('phone-shell'); app.appendChild(ProfileView()) }
  else { app.classList.add('phone-shell'); app.appendChild(OrderView()) }
}
window.addEventListener('hashchange', router); router();

/* Header actions */
document.getElementById('profileBtn').onclick=()=>{ location.hash='#/profile' };
</script>
</body>
</html>
